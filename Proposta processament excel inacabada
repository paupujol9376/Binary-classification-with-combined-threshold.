import pandas as pd
import zipfile
import os
import shutil

# 1. Configuración (Cambia esto por tus nombres de archivo)
nombre_zip = "tu_archivo.zip"  # Nombre de tu archivo comprimido
carpeta_extraccion = "datos_extraidos"
archivo_salida = "dataset_albert.csv"

# 2. Descomprimir el ZIP
with zipfile.ZipFile(nombre_zip, 'r') as zip_ref:
    zip_ref.extractall(carpeta_extraccion)
    print(f" Archivos extraídos en la carpeta: {carpeta_extraccion}")

# 3. Leer todos los excels y combinarlos
lista_tablas = []

for archivo in os.listdir(carpeta_extraccion):
    # Solo procesamos archivos que terminen en .xlsx o .xls
    if archivo.endswith(".xlsx") or archivo.endswith(".xls"):
        ruta_completa = os.path.join(carpeta_extraccion, archivo)
        
        # Leemos el excel
        df_temp = pd.read_excel(ruta_completa)
        
        # IMPORTANTE: Forzamos los nombres de las columnas que te piden
        # Esto asegura que C1, C2... se llamen exactamente así
        if len(df_temp.columns) >= 6:
            df_temp = df_temp.iloc[:, :6] # Tomamos las primeras 6 columnas por si hay basura a la derecha
            df_temp.columns = ["C1", "C2", "C3", "C4", "C5", "label"]
            lista_tablas.append(df_temp)
            print(f"   -> Procesado: {archivo}")
        else:
            print(f" Error en {archivo}: No tiene suficientes columnas.")

# 4. Unir todo y guardar
if lista_tablas:
    df_final = pd.concat(lista_tablas, ignore_index=True)
    df_final.to_csv(archivo_salida, index=False, encoding='utf-8')
    print(f"\n ¡Éxito! Creado el archivo: {archivo_salida}")
    print(f" Total de filas combinadas: {len(df_final)}")
else:
    print(" No se pudo crear el CSV porque no se encontraron archivos válidos.")

# 5. (Opcional) Limpiar la carpeta temporal
# shutil.rmtree(carpeta_extraccion)
